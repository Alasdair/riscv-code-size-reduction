## Zce Code saving estimation criteria 


# Benchmarking Background: 
This document present benchmarking results for Zce extension, baseline files were compiled using https://buildbot.embecosm.com/job/riscv32-gcc-ubuntu1804-release/5/artifact/riscv32-embecosm-ubuntu1804-gcc10.2.0-r4.tar.gz[gcc10.2.0-r4] with -march=rv32imc, -Os and -msave-restore unless otherwise specified. All results are generated from static analysis, and file sizes are calculated based on parsed instruction sizes of the ELF files, and the optimised sizes are calculated based on parsed instruction with relevant Zce instructions. 

List of benchmarks used: 

. https://github.com/embench/embench-iot[Embench] benchmark suite (By default Embench stubs external libraries including libgcc since benchmark recompilations wont result in any change in these libraries function, however, since we are performing static analysis, these benchmarks were linked against the actual libraries. If stubs were to be used, they would give an unfair advantage to msave-store since we wont count msave-store routine sizes when comparing it to push pop)
. https://github.com/riscv/riscv-code-size-reduction/tree/master/benchmarks/zephyr[Zepheyr] RTOS demos 
. Opus
. Test Float
. Subset of FPMARK 
. Coremark

It worth noting that all of the optimisations listed below, with the exception of (C.MVA01S07, C.MVA23S07 and C.MVP) are orthogonal in nature, thus their accumulative savings can be calculated from the summation of individual optimisations saving. 

# Zcec Subset: 

## C.TBLJAL
.. Find all (JAL, JALR, J and JR) instructions to be considered for replacement.
.. Remove entries that we won't gain any code saving from substituting, When number of identical (JAL or J) <  3.
.. Change the weight of JALR and JR entries to 3*Count (This would give them priority in selection, since their replacement results in more code saving).
.. Get the top 512 entries, evaluation of other lengths  xref:#shorter-table-length-for-tbljal[here].
.. Replace the entries in instruction record with the TBLJAL entries, and calculate the gains and compensate for the table size.


.TBLJAL 512 
[options="header", format="csv"]
|=======================
File , Size,Optimised Size, Table Length, Saving
File name,File Size,Optimised Size, Table Lenght, Saving
GCC10_huawei_iot_application,339682.0,307020.0,512,9.62%
GCC10_huawei_iot_protocol,960678.0,887320.0,512,7.64%
GCC10_zephyr_peripheral,76246.0,71232.0,221,6.58%
GCC10_zephyr_central,43434.0,40900.0,133,5.83%
GCC10_opus_demo_float,206210.0,197216.0,182,4.36%
GCC10_testsoftfloat,135738.0,129992.0,195,4.23%
GCC10_fpmark-inner-product-mid-10k,94838.0,91732.0,156,3.28%
GCC10_fpmark-radix2-sml-2k,87132.0,84706.0,154,2.78%
GCC10_fpmark-xp1px-sml-c100n20,80950.0,78834.0,146,2.61%
GCC10_embench_cubic,45632.0,44452.0,67,2.59%
GCC10_fpmark-atan-1M,80278.0,78266.0,148,2.51%
GCC10_embench_picojpeg,8164.0,7968.0,13,2.40%
GCC10_opus_demo_fixed,173248.0,170698.0,143,1.47%
GCC10_coremark,19360.0,19088.0,33,1.40%
GCC10_embench_nbody,10026.0,9888.0,27,1.38%
GCC10_embench_wikisort,13776.0,13594.0,37,1.32%
GCC10_embench_st,10228.0,10096.0,27,1.29%
GCC10_embench_minver,8944.0,8830.0,27,1.27%
GCC10_embench_ud,3522.0,3494.0,10,0.80%
GCC10_embench_crc32,388.0,386.0,1,0.52%
GCC10_embench_nettle-aes,3290.0,3274.0,3,0.49%
GCC10_embench_sglib-combined,2542.0,2534.0,2,0.31%
GCC10_embench_qrduino,6314.0,6298.0,5,0.25%
GCC10_embench_nettle-sha256,6120.0,6116.0,1,0.07%
GCC10_embench_slre,2672.0,2670.0,1,0.07%
GCC10_embench_statemate,4312.0,4310.0,1,0.05%
GCC10_embench_aha-mont64,1204.0,1204.0,0,0.00%
GCC10_embench_edn,1696.0,1696.0,0,0.00%
GCC10_embench_huffbench,1888.0,1888.0,0,0.00%
GCC10_embench_matmult-int,652.0,652.0,0,0.00%
GCC10_embench_nsichneu,15208.0,15208.0,0,0.00%
|=======================

## C.MVA01S07, C.MVA23S07 and C.MVP
.. Find all moves consecutive moves
.. Filter moves that fit the criteria for each of the proposed encoding
.. Overwrite each multiple move that fit the replacement criteria  with the new moves instruction

.C.MVP
[options="header", format="csv"]
|=======================
File name,File Size,Savings
GCC10_embench_aha-mont64,1204.0,3.32%
GCC10_embench_nbody,10026.0,0.50%
GCC10_fpmark-inner-product-mid-10k,94838.0,0.39%
GCC10_huawei_iot_application,339682.0,0.37%
GCC10_embench_st,10228.0,0.25%
GCC10_huawei_iot_protocol,960678.0,0.20%
GCC10_zephyr_central,43434.0,0.20%
GCC10_zephyr_peripheral,76246.0,0.19%
GCC10_opus_demo_float,206210.0,0.18%
GCC10_fpmark-radix2-sml-2k,87132.0,0.17%
GCC10_fpmark-atan-1M,80278.0,0.15%
GCC10_fpmark-xp1px-sml-c100n20,80950.0,0.15%
GCC10_testsoftfloat,135738.0,0.15%
GCC10_coremark,19360.0,0.12%
GCC10_embench_minver,8944.0,0.07%
GCC10_embench_cubic,45632.0,0.06%
GCC10_embench_ud,3522.0,0.06%
GCC10_embench_wikisort,13776.0,0.06%
GCC10_opus_demo_fixed,173248.0,0.06%
GCC10_embench_nettle-sha256,6120.0,0.03%
GCC10_embench_picojpeg,8164.0,0.02%
GCC10_embench_crc32,388.0,0.00%
GCC10_embench_edn,1696.0,0.00%
GCC10_embench_huffbench,1888.0,0.00%
GCC10_embench_matmult-int,652.0,0.00%
GCC10_embench_nettle-aes,3290.0,0.00%
GCC10_embench_nsichneu,15208.0,0.00%
GCC10_embench_qrduino,6314.0,0.00%
GCC10_embench_sglib-combined,2542.0,0.00%
GCC10_embench_slre,2672.0,0.00%
GCC10_embench_statemate,4312.0,0.00%
|=======================

.MVAxxS07
[options="header", format="csv"]
|=======================
,Size,MVA01S07,MVA23S07,Total
GCC10_embench_aha-mont64,1204,0.17%,0.50%,0.67%
GCC10_zephyr_central,43434,0.50%,0.01%,0.51%
GCC10_testsoftfloat,135738,0.32%,0.13%,0.45%
GCC10_zephyr_peripheral,76246,0.43%,0.01%,0.44%
GCC10_embench_huffbench,1888,0.32%,0.11%,0.43%
GCC10_huawei_iot_application,339682,0.32%,0.10%,0.42%
GCC10_opus_demo_float,206210,0.36%,0.05%,0.41%
GCC10_fpmark-inner-product-mid-10k,94838,0.28%,0.10%,0.38%
GCC10_embench_qrduino,6314,0.32%,0.00%,0.32%
GCC10_huawei_iot_protocol,960678,0.23%,0.07%,0.30%
GCC10_embench_st,10228,0.18%,0.10%,0.28%
GCC10_embench_nbody,10026,0.12%,0.12%,0.24%
GCC10_embench_sglib-combined,2542,0.24%,0.00%,0.24%
GCC10_embench_wikisort,13776,0.17%,0.01%,0.18%
GCC10_coremark,19360,0.12%,0.05%,0.17%
GCC10_fpmark-radix2-sml-2k,87132,0.12%,0.05%,0.17%
GCC10_opus_demo_fixed,173248,0.14%,0.02%,0.16%
GCC10_fpmark-atan-1M,80278,0.11%,0.04%,0.15%
GCC10_fpmark-xp1px-sml-c100n20,80950,0.11%,0.04%,0.15%
GCC10_embench_nettle-sha256,6120,0.10%,0.00%,0.10%
GCC10_embench_minver,8944,0.02%,0.07%,0.09%
GCC10_embench_cubic,45632,0.04%,0.04%,0.08%
GCC10_embench_slre,2672,0.00%,0.07%,0.07%
GCC10_embench_nettle-aes,3290,0.06%,0.00%,0.06%
GCC10_embench_picojpeg,8164,0.02%,0.00%,0.02%
GCC10_embench_crc32,388,0.00%,0.00%,0.00%
GCC10_embench_edn,1696,0.00%,0.00%,0.00%
GCC10_embench_matmult-int,652,0.00%,0.00%,0.00%
GCC10_embench_nsichneu,15208,0.00%,0.00%,0.00%
GCC10_embench_statemate,4312,0.00%,0.00%,0.00%
GCC10_embench_ud,3522,0.00%,0.00%,0.00%
|=======================

## C.SBSP, C.LBUSP, C.SHSP and C.LHUSP
.. Find all SB / LBU instructions
.. Replace all the ones that match the following criteria with the proposed compressed instruction
... Stack relative
... Reg name > 7 and Reg name < 16
... Immediate value:
.... Less than 2^5 for C.SBSP and C.LBUSP
.... Less than 2^6 and is even for C.SHSP and C.C.LHUSP

.SP Relative Store and Load
[options="header", format="csv"]
|=======================
,Size,C.LBUSP,C.SBSP,C.LHUSP,C.SHSP,Total
GCC10_huawei_iot_application,339682,0.14%,0.20%,0.12%,0.20%,0.66%
GCC10_huawei_iot_protocol,960678,0.15%,0.21%,0.08%,0.19%,0.63%
GCC10_zephyr_central,43434,0.08%,0.20%,0.04%,0.19%,0.51%
GCC10_zephyr_peripheral,76246,0.06%,0.15%,0.03%,0.14%,0.38%
GCC10_coremark,19360,0.00%,0.01%,0.00%,0.11%,0.12%
GCC10_testsoftfloat,135738,0.06%,0.01%,0.00%,0.00%,0.07%
GCC10_embench_picojpeg,8164,0.05%,0.00%,0.00%,0.00%,0.05%
GCC10_fpmark-radix2-sml-2k,87132,0.00%,0.01%,0.00%,0.02%,0.03%
GCC10_fpmark-atan-1M,80278,0.00%,0.01%,0.00%,0.02%,0.03%
GCC10_fpmark-inner-product-mid-10k,94838,0.00%,0.01%,0.00%,0.02%,0.03%
GCC10_embench_cubic,45632,0.00%,0.00%,0.00%,0.03%,0.03%
GCC10_fpmark-xp1px-sml-c100n20,80950,0.00%,0.00%,0.00%,0.01%,0.01%
GCC10_embench_sglib-combined,2542,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_wikisort,13776,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_ud,3522,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_opus_demo_fixed,173248,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_st,10228,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_statemate,4312,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_slre,2672,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_nettle-aes,3290,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_qrduino,6314,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_nsichneu,15208,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_nettle-sha256,6120,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_nbody,10026,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_minver,8944,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_matmult-int,652,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_huffbench,1888,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_edn,1696,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_crc32,388,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_aha-mont64,1204,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_opus_demo_float,206210,0.00%,0.00%,0.00%,0.00%,0.00%
|=======================


## C.SEXT.B C.SEXT.H 
.. Find all srai instructions dependent on slli
.. Replace the ones that match the replacement criteria

[options="header", format="csv"]
|=======================
,Size,C.SEXT.B,C.SEXT.H,Total
GCC10_embench_edn,1696,1.42%,1.77%,3.19%
GCC10_embench_picojpeg,8164,0.73%,1.67%,2.40%
GCC10_opus_demo_fixed,173248,0.60%,1.22%,1.82%
GCC10_opus_demo_float,206210,0.24%,0.44%,0.68%
GCC10_coremark,19360,0.12%,0.20%,0.32%
GCC10_embench_qrduino,6314,0.13%,0.13%,0.26%
GCC10_testsoftfloat,135738,0.01%,0.09%,0.10%
GCC10_embench_sglib-combined,2542,0.00%,0.08%,0.08%
GCC10_huawei_iot_protocol,960678,0.01%,0.03%,0.04%
GCC10_huawei_iot_application,339682,0.01%,0.02%,0.03%
GCC10_fpmark-radix2-sml-2k,87132,0.01%,0.01%,0.02%
GCC10_fpmark-xp1px-sml-c100n20,80950,0.01%,0.01%,0.02%
GCC10_fpmark-inner-product-mid-10k,94838,0.01%,0.01%,0.02%
GCC10_fpmark-atan-1M,80278,0.01%,0.01%,0.02%
GCC10_embench_nsichneu,15208,0.00%,0.00%,0.00%
GCC10_zephyr_central,43434,0.00%,0.00%,0.00%
GCC10_embench_wikisort,13776,0.00%,0.00%,0.00%
GCC10_embench_ud,3522,0.00%,0.00%,0.00%
GCC10_embench_st,10228,0.00%,0.00%,0.00%
GCC10_embench_statemate,4312,0.00%,0.00%,0.00%
GCC10_embench_slre,2672,0.00%,0.00%,0.00%
GCC10_embench_cubic,45632,0.00%,0.00%,0.00%
GCC10_embench_nettle-sha256,6120,0.00%,0.00%,0.00%
GCC10_embench_nettle-aes,3290,0.00%,0.00%,0.00%
GCC10_embench_nbody,10026,0.00%,0.00%,0.00%
GCC10_embench_minver,8944,0.00%,0.00%,0.00%
GCC10_embench_matmult-int,652,0.00%,0.00%,0.00%
GCC10_embench_huffbench,1888,0.00%,0.00%,0.00%
GCC10_embench_crc32,388,0.00%,0.00%,0.00%
GCC10_embench_aha-mont64,1204,0.00%,0.00%,0.00%
GCC10_zephyr_peripheral,76246,0.00%,0.00%,0.00%
|=======================


## C.ZEXT.B C.ZEXT.H
.. Find all stli instructions dependent on slli
.. Replace the ones that match the replacement criteria#

[options="header", format="csv"]
|=======================
,Size,C.ZEXT.B,C.ZEXT.H,Total
GCC10_embench_picojpeg,8164,0.78%,1.89%,2.67%
GCC10_embench_edn,1696,0.00%,2.24%,2.24%
GCC10_embench_qrduino,6314,1.46%,0.00%,1.46%
GCC10_huawei_iot_application,339682,0.17%,0.55%,0.72%
GCC10_coremark,19360,0.12%,0.58%,0.70%
GCC10_huawei_iot_protocol,960678,0.26%,0.41%,0.67%
GCC10_embench_crc32,388,0.52%,0.00%,0.52%
GCC10_zephyr_central,43434,0.12%,0.39%,0.51%
GCC10_testsoftfloat,135738,0.04%,0.46%,0.50%
GCC10_zephyr_peripheral,76246,0.11%,0.25%,0.36%
GCC10_embench_minver,8944,0.34%,0.00%,0.34%
GCC10_opus_demo_fixed,173248,0.01%,0.32%,0.33%
GCC10_embench_nettle-aes,3290,0.30%,0.00%,0.30%
GCC10_embench_nbody,10026,0.00%,0.24%,0.24%
GCC10_embench_cubic,45632,0.00%,0.24%,0.24%
GCC10_embench_st,10228,0.00%,0.23%,0.23%
GCC10_embench_slre,2672,0.22%,0.00%,0.22%
GCC10_embench_statemate,4312,0.19%,0.00%,0.19%
GCC10_embench_wikisort,13776,0.00%,0.17%,0.17%
GCC10_embench_aha-mont64,1204,0.17%,0.00%,0.17%
GCC10_fpmark-atan-1M,80278,0.08%,0.09%,0.17%
GCC10_fpmark-xp1px-sml-c100n20,80950,0.07%,0.09%,0.16%
GCC10_fpmark-radix2-sml-2k,87132,0.08%,0.08%,0.16%
GCC10_fpmark-inner-product-mid-10k,94838,0.07%,0.08%,0.15%
GCC10_opus_demo_float,206210,0.03%,0.08%,0.11%
GCC10_embench_huffbench,1888,0.11%,0.00%,0.11%
GCC10_embench_nettle-sha256,6120,0.00%,0.03%,0.03%
GCC10_embench_matmult-int,652,0.00%,0.00%,0.00%
GCC10_embench_nsichneu,15208,0.00%,0.00%,0.00%
GCC10_embench_sglib-combined,2542,0.00%,0.00%,0.00%
GCC10_embench_ud,3522,0.00%,0.00%,0.00%
|=======================


## C.LSBNOT 
.. Find all XORI instructions and replace all  the ones that has immediate = 1 with C.LSBNOT  and change WoE to 16

.C.LSBNOT
[options="header", format="csv"]
|=======================
File name,File Size,Savings
GCC10_embench_aha-mont64,1204.0,0.17%
GCC10_embench_slre,2672.0,0.15%
GCC10_embench_qrduino,6314.0,0.10%
GCC10_embench_sglib-combined,2542.0,0.08%
GCC10_embench_nbody,10026.0,0.04%
GCC10_embench_st,10228.0,0.04%
GCC10_testsoftfloat,135738.0,0.04%
GCC10_embench_wikisort,13776.0,0.03%
GCC10_opus_demo_fixed,173248.0,0.03%
GCC10_opus_demo_float,206210.0,0.03%
GCC10_embench_cubic,45632.0,0.02%
GCC10_embench_minver,8944.0,0.02%
GCC10_fpmark-atan-1M,80278.0,0.02%
GCC10_huawei_iot_protocol,960678.0,0.02%
GCC10_coremark,19360.0,0.01%
GCC10_fpmark-inner-product-mid-10k,94838.0,0.01%
GCC10_fpmark-radix2-sml-2k,87132.0,0.01%
GCC10_fpmark-xp1px-sml-c100n20,80950.0,0.01%
GCC10_huawei_iot_application,339682.0,0.01%
GCC10_zephyr_central,43434.0,0.01%
GCC10_zephyr_peripheral,76246.0,0.01%
GCC10_embench_crc32,388.0,0.00%
GCC10_embench_edn,1696.0,0.00%
GCC10_embench_huffbench,1888.0,0.00%
GCC10_embench_matmult-int,652.0,0.00%
GCC10_embench_nettle-aes,3290.0,0.00%
GCC10_embench_nettle-sha256,6120.0,0.00%
GCC10_embench_nsichneu,15208.0,0.00%
GCC10_embench_picojpeg,8164.0,0.00%
GCC10_embench_statemate,4312.0,0.00%
GCC10_embench_ud,3522.0,0.00%
|=======================

## C.MUL
.. Find all multiplication instructions
.. Replace all the ones that match the following criteria with the C.MUL and overwrite WoE to 16 
...  Dst and Src (Reg name > 7 and Reg name < 16)

.C.MUL
[options="header", format="csv"]
|=======================
File name,File Size,Savings
GCC10_embench_aha-mont64,1204.0,0.17%
GCC10_embench_slre,2672.0,0.15%
GCC10_embench_qrduino,6314.0,0.10%
GCC10_embench_sglib-combined,2542.0,0.08%
GCC10_embench_nbody,10026.0,0.04%
GCC10_embench_st,10228.0,0.04%
GCC10_testsoftfloat,135738.0,0.04%
GCC10_embench_wikisort,13776.0,0.03%
GCC10_opus_demo_fixed,173248.0,0.03%
GCC10_opus_demo_float,206210.0,0.03%
GCC10_embench_cubic,45632.0,0.02%
GCC10_embench_minver,8944.0,0.02%
GCC10_fpmark-atan-1M,80278.0,0.02%
GCC10_huawei_iot_protocol,960678.0,0.02%
GCC10_coremark,19360.0,0.01%
GCC10_fpmark-inner-product-mid-10k,94838.0,0.01%
GCC10_fpmark-radix2-sml-2k,87132.0,0.01%
GCC10_fpmark-xp1px-sml-c100n20,80950.0,0.01%
GCC10_huawei_iot_application,339682.0,0.01%
GCC10_zephyr_central,43434.0,0.01%
GCC10_zephyr_peripheral,76246.0,0.01%
GCC10_embench_crc32,388.0,0.00%
GCC10_embench_edn,1696.0,0.00%
GCC10_embench_huffbench,1888.0,0.00%
GCC10_embench_matmult-int,652.0,0.00%
GCC10_embench_nettle-aes,3290.0,0.00%
GCC10_embench_nettle-sha256,6120.0,0.00%
GCC10_embench_nsichneu,15208.0,0.00%
GCC10_embench_picojpeg,8164.0,0.00%
GCC10_embench_statemate,4312.0,0.00%
GCC10_embench_ud,3522.0,0.00%
|=======================

## C.SEXT.W and C.ZEXT.W  (No logic yet !!)


# Zces Subset: 

## C.PUSH
.. Traverse functions prologue 
.. Find negative stack adjustments
.. Find all stack relative store that has a negative offset and fits within the range 
_(abs(int(current_entry["Immediate"])+int(stack_adj_push[-1]["Adj"]["Immediate"])) < 60)_

.. Stop search at HOBs 
.. Check what is the maximum number of registers that we can fit in our replacement criteria
_rcount = { 0: ("ra",), 1: ("ra", "s0"),2: ("ra", "s0-s1"),3: ("ra", "s0-s2"),4:("ra", "s0-s3"),5: ("ra", "s0-s5"),6: ("ra", "s0-s8"),7: ("ra", "s0-s11")}_

.. Replace all instructions that fit the replacement criteria with the correct push instruction 

## C.POP and C.POPRET 
.. Traverse functions in reverse starting from epilogue
.. Find positive stack adjustments 
.. Find all stack relative  Load words that has positive offsets and fit within the range 
.. Stop search at HOBs 
.. Check what is the maximum number of registers that we can fit in our replacement criteria
.. Replace all instructions that fit the replacement criteria with the correct POP/POPRET instruction 


For this to work, we need to run the script across files compiled without msave-restore, so it can find the actual stack adjustments, loads and stores instead of calls to msave-restore routines. 

In the table below, the potential saving from running the script across files with no m-msave-restore are titled as NO_MSR_Savings. For fair relative comparison with other optimisations, these results are also presented to file sizes compiled with msave-restore: 

.PUSH POP
[options="header", format="csv"]
|=======================
File name,NO_MSR_File Size,NO_MSR_Savings,MSR File Size,Saving W.R.T MSR
GCC10_embench_crc32,228.0,17.54%,388.0,51.54%
GCC10_embench_matmult-int,524.0,15.65%,652.0,32.21%
GCC10_embench_aha-mont64,1080.0,7.59%,1204.0,17.11%
GCC10_embench_edn,1588.0,9.19%,1696.0,14.97%
GCC10_coremark,19506.0,13.12%,19360.0,12.46%
GCC10_embench_huffbench,1778.0,5.29%,1888.0,10.81%
GCC10_embench_nettle-aes,3238.0,9.20%,3290.0,10.64%
GCC10_fpmark-xp1px-sml-c100n20,82180.0,11.34%,80950.0,9.99%
GCC10_testsoftfloat,138598.0,11.72%,135738.0,9.86%
GCC10_fpmark-atan-1M,81814.0,11.55%,80278.0,9.86%
GCC10_fpmark-radix2-sml-2k,88756.0,11.35%,87132.0,9.70%
GCC10_fpmark-inner-product-mid-10k,97766.0,11.52%,94838.0,8.79%
GCC10_embench_sglib-combined,2580.0,10.08%,2542.0,8.74%
GCC10_embench_ud,3398.0,5.18%,3522.0,8.52%
GCC10_embench_slre,2700.0,9.33%,2672.0,8.38%
GCC10_embench_nettle-sha256,6010.0,4.53%,6120.0,6.25%
GCC10_embench_st,10196.0,5.77%,10228.0,6.06%
GCC10_embench_minver,8916.0,5.43%,8944.0,5.73%
GCC10_embench_nbody,9998.0,5.26%,10026.0,5.52%
GCC10_embench_statemate,4186.0,1.96%,4312.0,4.82%
GCC10_embench_cubic,45664.0,4.76%,45632.0,4.69%
GCC10_embench_wikisort,14026.0,6.30%,13776.0,4.60%
GCC10_opus_demo_fixed,177014.0,6.42%,173248.0,4.39%
GCC10_huawei_iot_application,359200.0,9.58%,339682.0,4.38%
GCC10_opus_demo_float,212492.0,7.17%,206210.0,4.34%
GCC10_embench_qrduino,6416.0,5.36%,6314.0,3.83%
GCC10_zephyr_central,47542.0,11.96%,43434.0,3.63%
GCC10_zephyr_peripheral,83266.0,11.52%,76246.0,3.37%
GCC10_embench_picojpeg,8554.0,7.69%,8164.0,3.28%
GCC10_huawei_iot_protocol,1023554.0,8.83%,960678.0,2.86%
GCC10_embench_nsichneu,15014.0,0.15%,15208.0,1.42%
|=======================



'*_Please note that the results above do not contain the savings from embedded moves for push pop yet_*'

# Zced Subset: 

## C.DECBGEZ 
	. NO LOGIC YET

## C.SB & C.LBU & C.SH and C.LHU
.. Find all SB / LBU / SH / LHU instructions
.. Replace all the ones that match the following criteria with the proposed compressed instruction
.. Immediate value bigger than 0 and less than 2^4

.C.LBU et al
[options="header", format="csv"]
|=======================
,Size,C.LBU,C.LHU,C.SB,C.SH,Total
GCC10_embench_statemate,4312,4.13%,0.00%,5.98%,0.05%,10.16%
GCC10_embench_qrduino,6314,4.09%,0.00%,2.03%,0.00%,6.12%
GCC10_embench_picojpeg,8164,2.08%,0.51%,1.67%,1.05%,5.31%
GCC10_embench_nettle-aes,3290,4.86%,0.00%,0.00%,0.00%,4.86%
GCC10_zephyr_central,43434,2.13%,0.56%,1.47%,0.37%,4.53%
GCC10_huawei_iot_protocol,960678,1.66%,0.63%,1.18%,0.46%,3.93%
GCC10_zephyr_peripheral,76246,1.85%,0.40%,1.02%,0.25%,3.52%
GCC10_embench_slre,2672,3.22%,0.00%,0.00%,0.00%,3.22%
GCC10_huawei_iot_application,339682,1.26%,0.58%,0.74%,0.35%,2.93%
GCC10_embench_edn,1696,0.12%,0.83%,0.12%,1.65%,2.72%
GCC10_embench_sglib-combined,2542,1.34%,0.00%,1.10%,0.00%,2.44%
GCC10_embench_huffbench,1888,0.85%,0.00%,0.85%,0.00%,1.70%
GCC10_coremark,19360,0.32%,0.35%,0.15%,0.41%,1.23%
GCC10_fpmark-atan-1M,80278,0.37%,0.15%,0.10%,0.16%,0.78%
GCC10_fpmark-xp1px-sml-c100n20,80950,0.36%,0.15%,0.10%,0.15%,0.76%
GCC10_testsoftfloat,135738,0.33%,0.14%,0.16%,0.10%,0.73%
GCC10_fpmark-radix2-sml-2k,87132,0.34%,0.14%,0.09%,0.15%,0.72%
GCC10_opus_demo_fixed,173248,0.14%,0.15%,0.10%,0.33%,0.72%
GCC10_fpmark-inner-product-mid-10k,94838,0.31%,0.13%,0.09%,0.14%,0.67%
GCC10_embench_matmult-int,652,0.31%,0.00%,0.31%,0.00%,0.62%
GCC10_opus_demo_float,206210,0.12%,0.05%,0.09%,0.13%,0.39%
GCC10_embench_ud,3522,0.28%,0.00%,0.06%,0.00%,0.34%
GCC10_embench_nettle-sha256,6120,0.16%,0.00%,0.16%,0.00%,0.32%
GCC10_embench_minver,8944,0.09%,0.00%,0.02%,0.00%,0.11%
GCC10_embench_wikisort,13776,0.07%,0.00%,0.03%,0.00%,0.10%
GCC10_embench_nbody,10026,0.08%,0.00%,0.00%,0.00%,0.08%
GCC10_embench_st,10228,0.08%,0.00%,0.00%,0.00%,0.08%
GCC10_embench_cubic,45632,0.02%,0.00%,0.01%,0.01%,0.04%
GCC10_embench_aha-mont64,1204,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_crc32,388,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_nsichneu,15208,0.00%,0.00%,0.00%,0.00%,0.00%
|=======================


# Appendix:

## Other variations of double move 
[options="header", format="csv"]
|=======================
,Size,MVA01S03,MVA23S03,MVP_EO_EO_SN,MVP_E_EO_SN,MVP_E_E_SN,MVP_E_E_S
GCC10_embench_aha-mont64,1204,0.00%,0.33%,3.65%,3.65%,3.65%,0.33%
GCC10_embench_st,10228,0.10%,0.08%,0.72%,0.68%,0.57%,0.31%
GCC10_fpmark-inner-product-mid-10k,94838,0.15%,0.04%,0.75%,0.67%,0.59%,0.20%
GCC10_zephyr_central,43434,0.38%,0.01%,0.62%,0.49%,0.39%,0.19%
GCC10_embench_nbody,10026,0.10%,0.00%,0.62%,0.60%,0.60%,0.10%
GCC10_testsoftfloat,135738,0.16%,0.07%,0.70%,0.47%,0.35%,0.20%
GCC10_huawei_iot_application,339682,0.22%,0.06%,0.57%,0.53%,0.46%,0.08%
GCC10_zephyr_peripheral,76246,0.32%,0.01%,0.58%,0.46%,0.34%,0.15%
GCC10_opus_demo_float,206210,0.13%,0.02%,0.48%,0.40%,0.27%,0.09%
GCC10_huawei_iot_protocol,960678,0.15%,0.04%,0.40%,0.34%,0.27%,0.07%
GCC10_fpmark-radix2-sml-2k,87132,0.08%,0.02%,0.39%,0.33%,0.29%,0.12%
GCC10_fpmark-xp1px-sml-c100n20,80950,0.10%,0.03%,0.33%,0.27%,0.24%,0.09%
GCC10_fpmark-atan-1M,80278,0.09%,0.02%,0.34%,0.28%,0.24%,0.09%
GCC10_coremark,19360,0.11%,0.02%,0.19%,0.17%,0.17%,0.04%
GCC10_embench_cubic,45632,0.01%,0.01%,0.25%,0.21%,0.14%,0.08%
GCC10_embench_wikisort,13776,0.10%,0.00%,0.20%,0.15%,0.13%,0.07%
GCC10_embench_sglib-combined,2542,0.16%,0.00%,0.16%,0.16%,0.08%,0.08%
GCC10_opus_demo_fixed,173248,0.06%,0.00%,0.19%,0.13%,0.09%,0.04%
GCC10_embench_huffbench,1888,0.00%,0.00%,0.21%,0.21%,0.00%,0.00%
GCC10_embench_nettle-aes,3290,0.06%,0.00%,0.06%,0.06%,0.06%,0.06%
GCC10_embench_minver,8944,0.00%,0.00%,0.11%,0.11%,0.07%,0.00%
GCC10_embench_qrduino,6314,0.22%,0.00%,0.03%,0.00%,0.00%,0.00%
GCC10_embench_slre,2672,0.00%,0.00%,0.15%,0.07%,0.00%,0.00%
GCC10_embench_picojpeg,8164,0.02%,0.00%,0.05%,0.05%,0.05%,0.02%
GCC10_embench_nettle-sha256,6120,0.10%,0.00%,0.03%,0.03%,0.03%,0.00%
GCC10_embench_ud,3522,0.00%,0.00%,0.06%,0.06%,0.06%,0.00%
GCC10_embench_matmult-int,652,0.00%,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_nsichneu,15208,0.00%,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_edn,1696,0.00%,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_statemate,4312,0.00%,0.00%,0.00%,0.00%,0.00%,0.00%
GCC10_embench_crc32,388,0.00%,0.00%,0.00%,0.00%,0.00%,0.00%
|=======================

## Shorter table length for TBLJAL
[options="header", format="csv"]
|=======================
File Name,File Size,128 Max,,256 Max,
huawei_iot_application.elf,344742,128,8.05%,256,8.51%
zephyr_peripheral.elf,76246,128,6.24%,221,6.58%
zephyr_central.elf,43434,128,5.81%,133,5.83%
huawei_iot_protocol.elf,963736,128,5.77%,256,6.41%
fpmark-radix2-sml-2k.elf,62610,78,2.96%,78,2.96%
fpmark-inner-product-mid-10k.elf,68454,82,2.85%,82,2.85%
fpmark-xp1px-sml-c100n20.elf,59014,77,2.76%,77,2.76%
fpmark-atan-1M.elf,57820,76,2.56%,76,2.56%
embench_picojpeg.elf,7922,11,2.30%,11,2.30%
embench_wikisort.elf,4030,7,0.84%,7,0.84%
embench_nettle-aes.elf,2694,1,0.22%,1,0.22%
embench_qrduino.elf,5952,4,0.20%,4,0.20%
embench_nettle-sha256.elf,5564,1,0.07%,1,0.07%
embench_aha-mont64.elf,1028,0,0.00%,0,0.00%
embench_crc32.elf,212,0,0.00%,0,0.00%
embench_cubic.elf,2088,0,0.00%,0,0.00%
embench_edn.elf,1428,0,0.00%,0,0.00%
embench_huffbench.elf,1608,0,0.00%,0,0.00%
embench_matmult-int.elf,398,0,0.00%,0,0.00%
embench_minver.elf,874,0,0.00%,0,0.00%
embench_nbody.elf,532,0,0.00%,0,0.00%
embench_nsichneu.elf,15020,0,0.00%,0,0.00%
embench_sglib-combined.elf,2272,0,0.00%,0,0.00%
embench_slre.elf,2386,0,0.00%,0,0.00%
embench_st.elf,586,0,0.00%,0,0.00%
embench_statemate.elf,4066,0,0.00%,0,0.00%
embench_ud.elf,650,0,0.00%,0,0.00%
|=======================


## 5 Bit immediate field for C.LBU et al
[options="header", format="csv"]
|=======================
Filename,Size,c.lbu,c.lhu,c.sb,c.sh
huawei_iot_protocol.elf,963736,2.26%,0.84%,1.80%,0.72%
huawei_iot_application.elf,344742,1.61%,0.66%,1.15%,0.53%
zephyr_peripheral.elf,76246,2.00%,0.50%,1.24%,0.38%
fpmark-inner-product-mid-10k.elf,68454,0.46%,0.19%,0.17%,0.21%
fpmark-radix2-sml-2k.elf,62610,0.51%,0.21%,0.18%,0.23%
fpmark-xp1px-sml-c100n20.elf,59014,0.54%,0.21%,0.18%,0.22%
fpmark-atan-1M.elf,57820,0.55%,0.23%,0.20%,0.25%
zephyr_central.elf,43434,2.28%,0.72%,1.75%,0.51%
embench_nsichneu.elf,15020,0.00%,0.00%,0.00%,0.00%
embench_picojpeg.elf,7922,2.80%,0.68%,3.13%,1.39%
embench_qrduino.elf,5952,7.36%,0.00%,2.49%,0.00%
embench_nettle-sha256.elf,5564,0.25%,0.04%,0.25%,0.00%
embench_statemate.elf,4066,9.94%,0.00%,13.58%,0.05%
embench_wikisort.elf,4030,0.00%,0.00%,0.00%,0.00%
embench_nettle-aes.elf,2694,6.01%,0.00%,2.38%,0.00%
embench_slre.elf,2386,3.44%,0.00%,0.00%,0.00%
embench_sglib-combined.elf,2272,1.41%,0.00%,1.06%,0.00%
embench_cubic.elf,2088,0.00%,0.00%,0.00%,0.00%
embench_huffbench.elf,1608,1.00%,0.00%,0.87%,0.00%
embench_edn.elf,1428,0.00%,0.98%,0.00%,1.96%
embench_aha-mont64.elf,1028,0.00%,0.00%,0.00%,0.00%
embench_minver.elf,874,0.00%,0.00%,0.00%,0.00%
embench_ud.elf,650,0.00%,0.00%,0.00%,0.00%
embench_st.elf,586,0.00%,0.00%,0.00%,0.00%
embench_nbody.elf,532,0.00%,0.00%,0.00%,0.00%
embench_matmult-int.elf,398,0.00%,0.00%,0.00%,0.00%
embench_crc32.elf,212,0.00%,0.00%,0.00%,0.00%
|=======================
