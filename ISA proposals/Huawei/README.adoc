= Code-size reduction ISA extension status

[push_pop_status_table]
.PUSH/POP status
[width=100%,options="header",]
|===================================================================================================
| Extension       |IoT application |IoT protocol |Zephyr Central |Zephyr Peripheral
5+|Text size of baseline build with -msave-restore
| baseline            | N/A   | N/A  | N/A     | N/A    
5+|Measured by compiling with HCC vs baseline
| PUSH/POP           | 4.90%  | 3.31% | 5.0%   | 4.08%  
5+|Improvement of PUSH+MV proposal over PUSH/POP estimated by a script, so elf files don't exist
| PUSH+MV           | 0.94% |1.02% | 1.55%    | 1.35%  
5+|Cumulative benefit of PUSH/POP and PUSH+MV, previous two rows added
| PUSH+MV/POP       | *5.84%* |*4.33%*|*6.57%* |*5.43%* 
|===================================================================================================

PUSH/POP spec is https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/riscv_push_pop_extension_RV32_RV64_UABI.adoc[here]

[table_jump_status_table]
.Table Jump status, for jump table mode
[width=100%,options="header",]
|===================================================================================================
|                 2+|IoT application 2+|IoT protocol 2+|Zephyr Central 2+|Zephyr Peripheral
9+|Estimated by a script, so elf files don't exist, relative to the baseline above, 256 table entries
| TBLJAL            2+| 9.90%  2+| 7.37% 2+| 7.23%  2+| 6.83%  
9+|relative the the HCC PUSH/POP output above, estimated by a script, 256 table entries
| TBLJAL + PUSH/POP 2+| 11.15%  2+| 8.20% 2+| 8.29%  2+| 8.57%  
9+|add in estimated benefit of PUSH+MV
| TBLJAL + PUSH+MV/POP 2+| *12.09%*  2+| *9.22%* 2+| *9.84%*  2+| *9.92%*
|===================================================================================================

Table jump spec is https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/table%20jump.adoc[here]

[ldstbh_status_table]
.`c.lbu/c.lhu/c.sb/c.sh` status
[width=100%,options="header",]
|===================================================================================================
|            |IoT application |IoT protocol |Zephyr Central |Zephyr Peripheral
5+|Compiled with HCC, 5-bit unsigned immediate, relative to baseline
| C.LBU/C.SB | 1.39%  | 1.80% | 2.56% | 1.88%  
5+|Compiled with HCC, 5-bit unsigned immediate, relative to baseline
| C.LHU/C.SH | 0.54%  | 0.79% | 0.68%  | 0.45%
5+|Add in estimated benefit of TBLJAL + PUSH+MV/POP
| total        |*14.02%*|*11.81%*|*13.08%*|*12.25%*
|===================================================================================================

We may decide that a shorter immediate value is acceptable for `c.lbu/c.lhu/c.sb/c.sh` or to only implement `c.lbu/c.sb` as the benefit is highest.

The multi-move spec is https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/multi_move.adoc[here]. I'm roughly estimating about 0.4% reduction, so  hopefully > 12% across the 4 benchmarks (accurate analysis to be done). 

Next to analyse and add into this table

- `LWGP/SWGP`
- `C.NOT/C.LSBNOT`
- `MULIADD/ADDIADD/MULI` - from Clare's proposal (need to locate it)
- `C.ZEXT.\*/C.SEXT.*`
- `C.MUL`
- https://github.com/riscv/riscv-code-size-reduction/blob/master/existing_extensions/Huawei%20Custom%20Extension/riscv_condbr_imm_extension.rst[cmp_imm_branch]
- https://github.com/riscv/riscv-code-size-reduction/blob/master/existing_extensions/Huawei%20Custom%20Extension/riscv_preshifted_arithmetic.rst[preshifted arithmetic]
- ...and look at the B-extension


